<html>
<head>
<title>Тестовое задание</title>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<script>
var generateUid = function (separator) {
    var delim = separator || "-";

    function S4() {
        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
    }

    return (S4() + S4() + delim + S4() + delim + S4() + delim + S4() + delim + S4() + S4() + S4());
};
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
    }
    return "";
}
function getLastDate(user){
var xmlhttp=new XMLHttpRequest();
    xmlhttp.open("GET","http://backendserver.com/userdate.php?user="+user,true);
    xmlhttp.send();
    xmlhttp.onreadystatechange=function() {
        if (xmlhttp.readyState==4 && xmlhttp.status==200) {
	            alert("О, Вы вернулись. Последний раз Вы заходили "+ xmlhttp.responseText); 
        }
    } 

}
function checkCookie() {
    var user = getCookie("username");
    if (user != "") {
	lastDate=getLastDate(user);
    } else {
        alert("Добро пожаловать на сайт!");
		var newuser = generateUid();
            setCookie("username", newuser, 365);
		getLastDate(newuser);
        
    }
}
(function() {
   checkCookie();
})();
</script>
</head>
<body>
<INPUT TYPE="button" onClick="history.go(0)" VALUE="Обновить страницу">
</body>
</html>
